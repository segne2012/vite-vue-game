import{_ as R}from"./plugin-vue_export-helper.21dcd24c.js";import{d as U,i as n,q as j,x as H,o as t,a as y,b as f,F as A,k as F,n as L,u as m,t as N,l as J,y as K,z as P,A as Q}from"./vendor.1ad6b5c0.js";const V=w=>(K("data-v-8d7c580a"),w=w(),P(),w),W={class:"tetris"},X={class:"leftView"},Y={class:"nextView"},Z={class:"source"},$={class:"level"},ee=V(()=>f("span",null,"\u7B49\u7EA7",-1)),ae=V(()=>f("div",{class:"level"},[f("div",null,"\u7A7A\u683C\uFF1A\u53D8\u5F62"),f("div",null,"\u5DE6\u53F3\uFF1A\u5DE6\u53F3\u79FB\u52A8"),f("div",null,"\xA0\xA0\xA0\u4E0B\uFF1A\u5FEB\u901F\u4E0B\u843D")],-1)),le={class:"mainView"},ue=U({setup(w){let v=n(20),b=n(40),B=n(0),k=n(1),h=n(!1),r=n([]),_=n([]),x=n(g()),a=n(g());function C(){_.value=Array.from({length:4},(o=0,u)=>{let l=u||0;return Array.from({length:4},(i=0,e)=>({x:e||0,y:l,flag:0}))}),r.value=Array.from({length:b.value},(o=0,u)=>{let l=u||0;return Array.from({length:v.value},(i=0,e)=>({x:e||0,y:l,flag:0}))})}function g(o=-1,u=-1){let l=o!=-1?o:Math.floor(Math.random()*6),i=u!=-1?u:Math.floor(Math.random()*4),e={type:l,radius:i,cells:[],cookies:{x:0,y:0},next:()=>{let s;switch(e.type){case 0:s=[[{x:0,y:-2,flag:1},{x:0,y:-1,flag:1},{x:0,y:0,flag:1},{x:0,y:1,flag:1}],[{x:-2,y:0,flag:1},{x:-1,y:0,flag:1},{x:0,y:0,flag:1},{x:1,y:0,flag:1}]],d(s[(e.radius+1)%2])&&e.radius++,e.cells=s[e.radius%2];break;case 1:s=[[{x:-1,y:-1,flag:1},{x:0,y:-1,flag:1},{x:0,y:0,flag:1},{x:0,y:1,flag:1}],[{x:-1,y:1,flag:1},{x:-1,y:0,flag:1},{x:0,y:0,flag:1},{x:1,y:0,flag:1}],[{x:0,y:-1,flag:1},{x:0,y:0,flag:1},{x:0,y:1,flag:1},{x:1,y:1,flag:1}],[{x:-1,y:0,flag:1},{x:0,y:0,flag:1},{x:1,y:0,flag:1},{x:1,y:-1,flag:1}]],d(s[(e.radius+1)%4])&&e.radius++,e.cells=s[e.radius%4];break;case 2:s=[[{x:-1,y:0,flag:1},{x:0,y:-1,flag:1},{x:0,y:0,flag:1},{x:0,y:1,flag:1}],[{x:-1,y:0,flag:1},{x:1,y:0,flag:1},{x:0,y:0,flag:1},{x:0,y:1,flag:1}],[{x:1,y:0,flag:1},{x:0,y:-1,flag:1},{x:0,y:0,flag:1},{x:0,y:1,flag:1}],[{x:-1,y:0,flag:1},{x:0,y:-1,flag:1},{x:0,y:0,flag:1},{x:1,y:0,flag:1}]],d(s[(e.radius+1)%4])&&e.radius++,e.cells=s[e.radius%4];break;case 3:s=[[{x:-1,y:1,flag:1},{x:0,y:-1,flag:1},{x:0,y:0,flag:1},{x:0,y:1,flag:1}],[{x:-1,y:0,flag:1},{x:1,y:0,flag:1},{x:0,y:0,flag:1},{x:1,y:1,flag:1}],[{x:1,y:-1,flag:1},{x:0,y:-1,flag:1},{x:0,y:0,flag:1},{x:0,y:1,flag:1}],[{x:-1,y:-1,flag:1},{x:-1,y:0,flag:1},{x:0,y:0,flag:1},{x:1,y:0,flag:1}]],d(s[(e.radius+1)%4])&&e.radius++,e.cells=s[e.radius%4];break;case 4:s=[[{x:-1,y:0,flag:1},{x:-1,y:-1,flag:1},{x:0,y:0,flag:1},{x:0,y:1,flag:1}],[{x:-1,y:0,flag:1},{x:0,y:-1,flag:1},{x:0,y:0,flag:1},{x:1,y:-1,flag:1}]],d(s[(e.radius+1)%2])&&e.radius++,e.cells=s[e.radius%2];break;case 5:s=[[{x:1,y:0,flag:1},{x:1,y:-1,flag:1},{x:0,y:0,flag:1},{x:0,y:1,flag:1}],[{x:1,y:0,flag:1},{x:0,y:-1,flag:1},{x:0,y:0,flag:1},{x:-1,y:-1,flag:1}]],d(s[(e.radius+1)%2])&&e.radius++,e.cells=s[e.radius%2];break;default:e.cells=[{x:-1,y:0,flag:1},{x:-1,y:-1,flag:1},{x:0,y:0,flag:1},{x:0,y:-1,flag:1}];break}},clearOld:s=>{e.cells.forEach(c=>{s.value&&s.value[c.y+e.cookies.y]&&s.value[c.y+e.cookies.y][c.x+e.cookies.x]&&(s.value[c.y+e.cookies.y][c.x+e.cookies.x].flag=0)})},render:(s,c,E)=>{e.cells.length===0&&(e.radius--,e.next()),e.clearOld(E),e.cookies.x+=s,e.cookies.y+=c,e.cells.forEach(p=>{E.value[p.y+e.cookies.y]&&E.value[p.y+e.cookies.y][p.x+e.cookies.x]&&(E.value[p.y+e.cookies.y][p.x+e.cookies.x].flag=1)})}};return e}function I(){C(),h.value=!1,a.value=g(),a.value.render(v.value/2,0,r),x.value=g(),x.value.render(2,2,_),S()}function D(o){let u=!0;switch(o.key){case"ArrowDown":console.log("\u4E0B");break;case"ArrowLeft":a.value.cells.forEach(l=>{(l.x+a.value.cookies.x-1<0||r.value[l.y+a.value.cookies.y][l.x+a.value.cookies.x-1].flag===2)&&(u=!1)}),u&&a.value.render(-1,0,r);break;case"ArrowRight":a.value.cells.forEach(l=>{(l.x+a.value.cookies.x+1>v.value-1||r.value[l.y+a.value.cookies.y][l.x+a.value.cookies.x+1].flag===2)&&(u=!1)}),u&&a.value.render(1,0,r);break;case" ":console.log("\u7A7A\u683C"),O();break;default:console.log("\u5176\u4ED6");break}}function O(){a.value.clearOld(r),a.value.next(),a.value.render(0,0,r)}function d(o=[]){let u=!0;return a.value.cookies.y===0||o.forEach(l=>{(l.x+a.value.cookies.x<=0||l.x+a.value.cookies.x>v.value-1||l.y+a.value.cookies.y>b.value-1||r.value[l.y+a.value.cookies.y][l.x+a.value.cookies.x].flag===2)&&(u=!1)}),u}function z(){a.value.cells.forEach(o=>{o.y+a.value.cookies.y<=0&&(h.value=!0),r.value&&r.value[o.y+a.value.cookies.y]&&r.value[o.y+a.value.cookies.y][o.x+a.value.cookies.x]&&(r.value[o.y+a.value.cookies.y][o.x+a.value.cookies.x].flag=2)}),G(),a.value=g(x.value.type,x.value.radius),a.value.render(v.value/2,0,r),x.value.render(-10,-10,_),Q(()=>{x.value=g(),x.value.render(2,2,_)})}function G(){let o=new Set;a.value.cells.forEach(u=>{let l=!0;r.value[u.y+a.value.cookies.y].forEach(i=>{i.flag===0&&(l=!1)}),l&&o.add(u.y+a.value.cookies.y)}),o.size>0&&(B.value+=(2*o.size-1)*10,k.value=Math.floor(B.value/1e3)+1,k.value>12&&(k.value=12)),o.forEach(u=>{for(let l=u;l>0;l--)r.value[l]=r.value[l-1];r.value[0]=new Array(v.value).fill(0).map(()=>({x:0,y:0,flag:0}))})}let T=500,M=0;function S(){new Date().getTime()-M>T*Math.pow(.8,k.value-1)&&(M=new Date().getTime(),q()?z():a.value.render(0,1,r)),!h.value&&window.requestAnimationFrame(S)}function q(){let o=!1,u=a.value.cells;for(let l=0;l<u.length;l++){let i=u[l];if(i.y+a.value.cookies.y+1>=b.value)return o=!0,!0;r.value&&r.value[i.y+a.value.cookies.y+1]&&r.value[i.y+a.value.cookies.y+1][i.x+a.value.cookies.x]&&r.value[i.y+a.value.cookies.y+1][i.x+a.value.cookies.x].flag===2&&(o=!0)}return o}return j(()=>{C(),h.value=!0,window.addEventListener("keydown",D)}),H(()=>{window.removeEventListener("keydown",D)}),(o,u)=>(t(),y("div",W,[f("div",X,[f("div",Y,[(t(!0),y(A,null,F(m(_),l=>(t(),y("span",{key:l.toLocaleString(),class:"row"},[(t(!0),y(A,null,F(l,i=>(t(),y("span",{key:i.toString(),class:L(["cell",{active:i.flag===1}])},null,2))),128))]))),128))]),f("div",Z,N(m(B)),1),f("div",$,[ee,f("span",null,N(m(k)),1)]),ae]),f("div",le,[(t(!0),y(A,null,F(m(r),l=>(t(),y("span",{key:l.toString,class:"row"},[(t(!0),y(A,null,F(l,i=>(t(),y("span",{key:i.x+","+i.y,class:L(["cell",{active:i.flag===1,flag:i.flag===2}])},null,2))),128))]))),128))]),m(h)?(t(),y("div",{key:0,class:"gameOver",onClick:I}," \u6E38\u620F\u7ED3\u675F\uFF0C\u70B9\u51FB\u91CD\u65B0\u5F00\u59CB ")):J("",!0)]))}});var re=R(ue,[["__scopeId","data-v-8d7c580a"]]);export{re as default};
